<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Create Multi-Item Order</title>
  <style>body{font-family:Arial;max-width:600px;margin:auto;padding:20px}</style>
</head>
<body>
  <h1>Create Order</h1>
  <form id="orderForm">
    <label>Name:<input name="name" required></label><br>
    <label>Email:<input name="email"></label><br>
    <label>Phone:<input name="phone"></label><br>
    <label>Address:<textarea name="address"></textarea></label><br>
    <h3>Items</h3>
    <div id="items">
      <div class="item">
        <input name="items[0][name]" placeholder="Item name" required>
        <input name="items[0][sku]" placeholder="SKU">
        <input name="items[0][price]" type="number" placeholder="Price" step="0.01" required>
        <input name="items[0][qty]" type="number" value="1" min="1" required>
      </div>
    </div>
    <button type="button" id="add">Add item</button><br><br>
    <label>Tax rate: <input name="tax_rate" value="0.12"></label><br>
    <label>Discount: <input name="discount" value="0"></label><br><br>
    <button type="submit">Submit</button>
  </form>
  <pre id="result"></pre>

  <script>
    let idx=1;
    document.getElementById('add').onclick=()=>{
      const div=document.createElement('div');
      div.className='item';
      div.innerHTML=`<input name="items[${idx}][name]" placeholder="Item name" required>
                     <input name="items[${idx}][sku]" placeholder="SKU">
                     <input name="items[${idx}][price]" type="number" placeholder="Price" step="0.01" required>
                     <input name="items[${idx}][qty]" type="number" value="1" min="1" required>
                     <button type="button" onclick="this.parentElement.remove()">Remove</button>`;
      document.getElementById('items').appendChild(div);
      idx++;
    };
    document.getElementById('orderForm').onsubmit=async e=>{
      e.preventDefault();
      const f=new FormData(e.target);
      const customer={name:f.get('name'),email:f.get('email'),phone:f.get('phone'),address:f.get('address')};
      const items=[];
      document.querySelectorAll('#items .item').forEach(div=>{
        const name=div.querySelector('[name$="[name]"]').value;
        const sku=div.querySelector('[name$="[sku]"]').value;
        const price=parseFloat(div.querySelector('[name$="[price]"]').value);
        const qty=parseInt(div.querySelector('[name$="[qty]"]').value);
        items.push({name,sku,price,qty});
      });
      const payload={customer,items,tax_rate:parseFloat(f.get('tax_rate')),discount:parseFloat(f.get('discount'))};
      const res=await fetch('create_order.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      const json=await res.json();
      document.getElementById('result').textContent=JSON.stringify(json,null,2);
      if(json.success) window.open('get_invoice.php?invoice_number='+json.invoice_number,'_blank');
    };
  </script>
</body>
</html>
